!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("dedux",[],t):"object"==typeof exports?exports.dedux=t():e.dedux=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}([function(e,t,r){"use strict";var n=Symbol("id"),i=Symbol("foreign key"),o=Symbol("proxy"),a=Symbol("entity"),u=Symbol("get-normalized"),c=Symbol("get-schema"),f=Symbol("root data"),l=Symbol("replace");e.exports={entity:a,id:n,foreignKey:i,getNormalized:u,getSchema:c,getRootData:f,replace:l,proxy:o}},function(e,t,r){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=r(9),u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._entity=t}return o(e,[{key:"typeOf",value:function(e){var t=void 0===e?"undefined":i(e);return"object"!==t?t:null===e?"null":Array.isArray(e)?"array":"object"}},{key:"getElements",value:function(e){return"object"===this.typeOf(e)?Object.entries(e):"array"===this.typeOf(e)?e.map(function(e,t){return[t,e]}):void 0}},{key:"getName",value:function(e){return"string"===this.typeOf(e)?e:e.name}},{key:"isEntity",value:function(e){return!("object"!==this.typeOf(e)||!e[this._entity])}},{key:"isVacentTag",value:function(e){if(!this.isEntity(e))return!1;var t=Object.getOwnPropertySymbols(e).concat(Object.getOwnPropertyNames(e));return 1===t.length&&t[0]===this._entity}},{key:"validateTag",value:function(e){if("string"===this.typeOf(e))return t(e);if("object"===this.typeOf(e)){if("string"===this.typeOf(e.name))return t(e.name);throw new Error("Invalid Tag. \n\n            "+JSON.stringify(e)+" \n\n            Tag must contain a 'name' property with a string value")}throw new Error("Invalid Tag. \n\n         "+e+" \n\n         Tag must be a string or an object with a 'name' property and a string value");function t(e){if(e[0].toUpperCase()!==e[0]){if(!["number","string","boolean","function","null","undefined","object","array"].includes(e))throw new Error("Invalid Tag. "+e+" is not a valid primitive.")}}}},{key:"checkForInconsistencies",value:function(e,t,r){if(e&&t&&!a(e,t,{strict:!0}))throw new Error("Conflicting Schema definitions for "+r+". \n\n        "+JSON.stringify(e)+" \n\n        does not match \n\n        "+JSON.stringify(t))}},{key:"checkForUndefinedEntities",value:function(e){Object.entries(e).forEach(function(e){var t=n(e,2),r=t[0];if(void 0===t[1])throw new Error("Could not infer Schema on "+r)})}}]),e}();e.exports=u},function(e,t,r){"use strict";var n=r(0),i=(n.replace,n.entity),o=new(r(1))(i);e.exports=function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"object"===o.typeOf(t)?!!o.isEntity(t)||Object.values(t).reduce(function(t,n){return t||e(n,r)},r):"array"===o.typeOf(t)&&t.reduce(function(t,n){return t||e(n,r)},r)}},function(e,t,r){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var u=r(0),c=u.entity,f=u.id,l=u.foreignKey,s=u.proxy,y=new(r(1))(c),v=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._schema=t,this._rootEntity=r,this._normalized=function(e){var t={};return Reflect.ownKeys(e).forEach(function(e){return t[e]={}}),t}(t)}return o(e,[{key:"addToTable",value:function(e){var t,r=y.getName(e[c]),n=this._schema[r][f]++;return e[f]=n,this._normalized[r][n]=e,a(t={},l,n),a(t,"entityType",r),t}},{key:"addProxy",value:function(e,t){var r=this._schema[s][f]++;return e[s]=r,this._normalized[s][r]=i({},t,a({},f,r)),r}},{key:"getNormalizedData",value:function(){return{normalizedData:this._normalized,rootEntity:this._rootEntity,schema:this._schema}}}]),e}();e.exports=function(e,t){var r=new v(e,t);return function e(t,o){var u,c=o.parents,f=o.path,l=y.getElements(t);if(!l)return t;if(u=t,y.typeOf("array"===u)&&y.isVacentTag(u[0]))return[];var s=y.isEntity(t)&&r.addToTable(t);s&&(f=[s]);var v=r.addProxy(t,{parents:c,path:f});return c=i({},c,a({},v,!0)),l.forEach(function(r){var i=n(r,2),o=i[0],a=i[1];t[o]=e(a,{parents:c,path:[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(f),[o])})}),s||t}(t,{parents:{},path:[]}),r.getNormalizedData()}},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function a(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function u(e){return Array.isArray(e)?e:Array.from(e)}var c=r(0),f=c.entity,l=c.id,s=c.foreignKey,y=c.proxy,v=[f,l,s,y],d=new(r(1))(f),h=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._old=t,this._new={},this._oldRoot=r,this._proxyRemovalList=new Set}return o(e,[{key:"getEntity",value:function(e,t){return this._old[e][t]}},{key:"getPath",value:function(e){var t=e[y];return this._old[y][t].path}},{key:"addNewEntity",value:function(e){var t=d.getName(e[f]),r=e[l];this._new[t]||(this._new[t]={}),this._new[t][r]=e}},{key:"mergeAtPath",value:function(e,t,r){if(0===e.length)return this.merge(t,r);this.addToProxyRemovalList(t);var i=u(e),o=i[0],c=i.slice(1),f=function(e,t,r){if("object"===d.typeOf(t))return n({},t,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},e,r));if("array"===d.typeOf(t)){var i=t.slice(0,e),o=t.slice(e+1);return[].concat(a(i),[r],a(o))}}(o,t,this.mergeAtPath(c,t[o],r));if(!d.isEntity(f))return f;this.addNewEntity(f)}},{key:"merge",value:function(e,t){var r,n=this;if(r=e,"object"===d.typeOf(r)&&Object.getOwnPropertySymbols(r).includes(s)){var o=this.getEntity(e.entityType,e[s]);return this.merge(o,t),e}var a=d.getElements(t);return a?this.getEntity(y,e[y]).proxy===t?e:(Object.getOwnPropertySymbols(e).filter(function(e){return v.includes(e)}).forEach(function(r){return t[r]=e[r]}),a.forEach(function(r){var o=i(r,2),a=o[0],u=o[1];return t[a]=n.merge(e[a],u)}),this.addToProxyRemovalList(t),d.isEntity(t)?void this.addNewEntity(t):t):t}},{key:"addToProxyRemovalList",value:function(e){this._proxyRemovalList.add(e[y])}},{key:"addParentProxies",value:function(e){var t=this;this.getProxyParents(e).forEach(function(e){t._proxyRemovalList.has(e)||(t._proxyRemovalList.add(e),t.addParentProxies(e))})}},{key:"getProxyParents",value:function(e){var t=this._old[y][e].parents;return Object.keys(t)}},{key:"clearProxies",value:function(){var e=this._proxyRemovalList.values(),t=!0,r=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(t=(a=u.next()).done);t=!0){var c=a.value;this.addParentProxies(c)}}catch(e){r=!0,o=e}finally{try{!t&&u.return&&u.return()}finally{if(r)throw o}}e=this._proxyRemovalList.values();var f={};Object.entries(this._old[y]).forEach(function(e){var t=i(e,2),r=t[0],o=t[1];return f[r]=n({},o)});var l=!0,s=!1,v=void 0;try{for(var d,h=e[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var p=d.value;f[p].proxy=void 0}}catch(e){s=!0,v=e}finally{try{!l&&h.return&&h.return()}finally{if(s)throw v}}this._new[y]=f}},{key:"mergeInOldData",value:function(){var e=this;Object.entries(this._old).forEach(function(t){var r=i(t,2),o=r[0],a=r[1];e._new[o]?e._new[o]=n({},a,e._new[o]):e._new[o]=a})}},{key:"getNewRoot",value:function(){var e=this._oldRoot[f],t=this._oldRoot[l];return this._new[e][t]}},{key:"getNewData",value:function(){return this._new}}]),e}();e.exports=function(e,t,r,n){var i=new h(e,t),o=u(i.getPath(r)),a=o[0],c=a[s],f=a.entityType,l=o.slice(1),y=i.getEntity(f,c);return i.mergeAtPath(l,y,n),i.clearProxies(),i.mergeInOldData(),{normalizedData:i.getNewData(),rootEntity:i.getNewRoot()}}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=r(0),o=i.entity,a=(i.id,i.foreignKey,i.proxy),u=(new(r(1))(o),r(4)),c=function(){function e(t){var r=t.schema,n=t.normalizedData,i=t.rootEntity;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schema=r,this.normalizedData=n,this.rootEntity=i}return n(e,[{key:"getEntity",value:function(e,t){return this.normalizedData[e][t]}},{key:"getSchema",value:function(){return this.schema}},{key:"getRoot",value:function(){return this.rootEntity}},{key:"getNormalizedData",value:function(){return this.normalizedData}},{key:"getProxyFromCache",value:function(e){var t=e[a];return this.normalizedData[a][t].proxy}},{key:"setProxyInCache",value:function(e,t){var r=e[a];this.normalizedData[a][r].proxy=t}},{key:"replace",value:function(t,r){var n=u(this.normalizedData,this.rootEntity,t,r);return new e({normalizedData:n.normalizedData,rootEntity:n.rootEntity,schema:this.schema})}}]),e}();e.exports=c},function(e,t,r){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=r(0),u=a.entity,c=a.id,f=a.proxy,l=new(r(1))(u),s=function(){function e(){var t,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._schema=(n={},(r=f)in(t={})?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t)}return o(e,[{key:"addType",value:function(e){var t=e[u];l.validateTag(t);var r=l.getName(t);return delete e[u],this._schema[r]?l.checkForInconsistencies(e,this.schema[r],r):this._schema[r]=e,r}},{key:"addVacantType",value:function(e){var t=e[u];l.validateTag(t);var r=l.getName(t);return this._schema[r]||(this._schema[r]=void 0),r}},{key:"getSchema",value:function(){var e=this,t=Reflect.ownKeys(this._schema);return l.checkForUndefinedEntities(this._schema),t.forEach(function(t){return e._schema[t][c]=0}),this._schema}}]),e}();e.exports=function(e){var t=new s;return e[u]||(e[u]="ROOT"),function e(r){if("array"===l.typeOf(r))return[e(r[0])];if("object"===l.typeOf(r)){if(l.isVacentTag(r))return t.addVacantType(r);var o=i({},r);return Object.entries(o).forEach(function(t){var r=n(t,2),i=r[0],a=r[1];return o[i]=e(a)}),l.isEntity(o)?t.addType(o):o}return l.typeOf(r)}(e),t.getSchema()}},function(e,t){var r="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function n(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function i(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=r?n:i).supported=n,t.unsupported=i},function(e,t){function r(e){var t=[];for(var r in e)t.push(r);return t}(e.exports="function"==typeof Object.keys?Object.keys:r).shim=r},function(e,t,r){var n=Array.prototype.slice,i=r(8),o=r(7),a=e.exports=function(e,t,r){return r||(r={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?r.strict?e===t:e==t:function(e,t,r){var f,l;if(u(e)||u(t))return!1;if(e.prototype!==t.prototype)return!1;if(o(e))return!!o(t)&&(e=n.call(e),t=n.call(t),a(e,t,r));if(c(e)){if(!c(t))return!1;if(e.length!==t.length)return!1;for(f=0;f<e.length;f++)if(e[f]!==t[f])return!1;return!0}try{var s=i(e),y=i(t)}catch(e){return!1}if(s.length!=y.length)return!1;for(s.sort(),y.sort(),f=s.length-1;f>=0;f--)if(s[f]!=y[f])return!1;for(f=s.length-1;f>=0;f--)if(l=s[f],!a(e[l],t[l],r))return!1;return typeof e==typeof t}(e,t,r))};function u(e){return null===e||void 0===e}function c(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=r(0),o=i.entity,a=i.id,u=i.foreignKey,c=i.getNormalized,f=i.getSchema,l=i.getRootData,s=i.replace,y=i.proxy,v=i.dataProxy,d=i.schemaProxy,h=i.normalizedProxy,p=[o,a,u,y,c,h,f,d,l,v,s],E={data:[],schema:[o],normalized:[a,u]},m=new(r(1))(o),b=r(6),g=r(5),w=r(3);var _=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._proxyType=r,this._normalizedData=t,"data"===r?this._getProxy(t.getRoot()):"normalized"===r?this._getProxy(t.getNormalizedData()):"schema"===r?this._getProxy(t.getSchema()):void 0}return n(e,[{key:"_getProxy",value:function(e){if("data"!==this._proxyType)return this._createProxy(e);var t=this._normalizedData.getProxyFromCache(e);return t||(t=this._createProxy(e),this._normalizedData.setProxyInCache(e,t)),t}},{key:"_createProxy",value:function(t){var r=this,n=E[this._proxyType];return new Proxy(t,{get:function(t,i){return i===c?new e(r._normalizedData,"normalized"):i===f?new e(r._normalizedData,"schema"):i===l?r._getProxy(r._normalizedData.getRoot()):i===s?r._updateFn(t):n.includes(i)?r._lookupValue(t[i]):p.includes(i)?void 0:r._lookupValue(t[i])},ownKeys:function(e){var t=p.filter(function(e){return!n.includes(e)});return Reflect.ownKeys(e).filter(function(e){return!t.includes(e)})}})}},{key:"_updateFn",value:function(t){var r=this;return function(n){return new e(r._normalizedData.replace(t,n))}}},{key:"_lookupValue",value:function(e){var t=m.typeOf(e);if("object"!==t&&"array"!==t)return e;if("object"===t&&"data"===this._proxyType&&Object.getOwnPropertySymbols(e).includes(u)){var r=this._normalizedData.getEntity(e.entityType,e[u]);return this._getProxy(r)}return this._getProxy(e)}}]),e}();e.exports=function(e){var t=b(e),r=w(t,e),n=new g(r);return new _(n)}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e,t){if(void 0===e)return[];var r=[];return function e(t,r,i,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(""!==r&&(a+=(a?"_":"")+r.toUpperCase()),a===t||a.endsWith("_"+t))o(a);else{if("object"!==(void 0===i?"undefined":n(i))||Array.isArray(i))return;var u=!0,c=!1,f=void 0;try{for(var l,s=Object.keys(i)[Symbol.iterator]();!(u=(l=s.next()).done);u=!0){var y=l.value;e(t,y,i[y],o,a)}}catch(e){c=!0,f=e}finally{try{!u&&s.return&&s.return()}finally{if(c)throw f}}}}(e,"",t,function(e){return r.push(e)}),r}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function e(t,r,i){if(0===t.length)return i(r);if("object"!==(void 0===r?"undefined":n(r)))return r;var o=Object.assign({},r),a=!0,u=!1,c=void 0;try{for(var f,l=Object.keys(r)[Symbol.iterator]();!(a=(f=l.next()).done);a=!0){var s=f.value;s.toUpperCase()===t[0]&&(o[s]=e(t.slice(1),r[s],i))}}catch(e){u=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(u)throw c}}return o}},function(e,t,r){"use strict";e.exports=function(e){var t=void 0,r=void 0,n=!0,i=!1,o=void 0;try{for(var a,u=["SET_ALL","SET_IN","SET","INCREMENT_ALL","INCREMENT_IN","INCREMENT","DECREMENT_ALL","DECREMENT_IN","DECREMENT","TOGGLE_ALL","TOGGLE_IN","TOGGLE","ADD_TO","ADD","INSERT_IN","INSERT","REMOVE_ALL","REMOVE_FROM","REMOVE","MERGE_ALL","MERGE_IN","MERGE"][Symbol.iterator]();!(n=(a=u.next()).done);n=!0){var c=a.value;if(e.startsWith(c))return{verb:t=c,path:r=e.replace(t,"").replace("_","")}}}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return{verb:t,path:r}}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var l=r(13),s=r(12),y=r(11),v=r(10),d=r(2),h=r(0).replace,p=function(e,t){var r=y(e,t);if(0===r.length)throw new Error("Path not found.");if(r.length>1)throw new Error("Path not unique, try a longer path specification.");return r[0].split("_")};function E(e,t,r,n){if(!t)throw new Error("All actions need to have a configuration object.");!function(e,t){if(e){var r=y(e,t);if(0===r.length)throw new Error("Path: "+e+" could not be found.");if(r.length>1)throw new Error("Multiple valid paths found. Use a longer path to ensure a unique selection.")}}(t.path,n),function(e,t,r){if(t){if(r.includes("value")&&!("value"in t))throw new Error(e+" should include a value property in the payload.");if(r.includes("in")&&void 0===t.index&&void 0===t.key&&void 0===t.where)throw new Error(e+" should include either a key, index, or where property in the payload.");if(r.includes("index")&&void 0===t.index)throw new Error(e+" should include either a key or index property in the payload.")}}(e,t,r);var i=t.path;return delete t.path,i?Object.assign({type:e+"_"+i},t):Object.assign({type:e},t)}var m=function(){function e(t){u(this,e),this.closedState=t}return n(e,[{key:"SET_ALL",value:function(e){return E("SET_ALL",e,["value"],this.closedState.state)}},{key:"SET_IN",value:function(e){return E("SET_IN",e,["value","in"],this.closedState.state)}},{key:"SET",value:function(e){return E("SET",e,["value"],this.closedState.state)}},{key:"INCREMENT_ALL",value:function(e){return E("INCREMENT_ALL",e,["value"],this.closedState.state)}},{key:"INCREMENT_IN",value:function(e){return E("INCREMENT_IN",e,["value","in"],this.closedState.state)}},{key:"INCREMENT",value:function(e){return E("INCREMENT",e,["value"],this.closedState.state)}},{key:"DECREMENT_ALL",value:function(e){return E("DECREMENT_ALL",e,["value"],this.closedState.state)}},{key:"DECREMENT_IN",value:function(e){return E("DECREMENT_IN",e,["value","in"],this.closedState.state)}},{key:"DECREMENT",value:function(e){return E("DECREMENT",e,["value"],this.closedState.state)}},{key:"TOGGLE_ALL",value:function(e){return E("TOGGLE_ALL",e,[],this.closedState.state)}},{key:"TOGGLE_IN",value:function(e){return E("TOGGLE_IN",e,["in"],this.closedState.state)}},{key:"TOGGLE",value:function(e){return E("TOGGLE",e,[],this.closedState.state)}},{key:"ADD_TO",value:function(e){return E("ADD_TO",e,["value"],this.closedState.state)}},{key:"ADD",value:function(e){return E("ADD",e,["value"],this.closedState.state)}},{key:"INSERT_IN",value:function(e){return E("INSERT_IN",e,["value","in"],this.closedState.state)}},{key:"INSERT",value:function(e){return E("INSERT",e,["value"],this.closedState.state)}},{key:"REMOVE_ALL",value:function(e){return E("REMOVE_ALL",e,[],this.closedState.state)}},{key:"REMOVE_IN",value:function(e){return E("REMOVE_IN",e,["in"],this.closedState.state)}},{key:"REMOVE",value:function(e){return E("REMOVE",e,[],this.closedState.state)}},{key:"MERGE_ALL",value:function(e){return E("MERGE_ALL",e,["value"],this.closedState.state)}},{key:"MERGE_IN",value:function(e){return E("MERGE_IN",e,["value","in"],this.closedState.state)}},{key:"MERGE",value:function(e){return E("MERGE",e,["value"],this.closedState.state)}}]),e}(),b=new function e(){var t=this;u(this,e),this.closedState={},this.deduce=function(e){var r=e(void 0,{}),n=d(r),u=n&&v(r);return function(r,y){var v=e(r,y);return u=n?u[h](v):v,t.closedState.state=u,u!==r?u:"number"==typeof r?(t.closedState.state=function(e,t){switch(t.type){case"INCREMENT":return e+t.value;case"DECREMENT":return e-t.value;case"SET":return t.value;default:return e}}(r,y),t.closedState.state):"boolean"==typeof r?(t.closedState.state=function(e,t){switch(t.type){case"SET":return t.value;case"TOGGLE":return!e;default:return e}}(r,y),t.closedState.state):"string"==typeof r?(t.closedState.state=function(e,t){switch(t.type){case"SET":return t.value;default:return e}}(r,y),t.closedState.state):Array.isArray(r)?(t.closedState.state=function(e,t){switch(t.type){case"ADD":return[].concat(f(e),[t.value]);case"CONCAT":return[].concat(f(e),f(t.value));case"REMOVE_ALL":return[];case"REMOVE_IN":if(void 0!==t.where)return e.filter(function(e){return!t.where(e)});if(void 0===t.index&&(t.index=e.length-1),void 0!==t.index)return[].concat(f(e.slice(0,t.index)),f(e.slice(t.index+1)));case"SET_IN":if(void 0!==t.index)return[].concat(f(e.slice(0,t.index)),[t.value],f(e.slice(t.index+1)));if(void 0!==t.where)return e.map(function(e){return t.where(e)?t.value:e});case"SET_ALL":return e.map(function(e){return t.value});case"TOGGLE_IN":if(void 0!==t.index)return[].concat(f(e.slice(0,t.index)),[!e[t.index]],f(e.slice(t.index+1)));if(void 0!==t.where)return e.map(function(e){return t.where(e)?!e:e});case"TOGGLE_ALL":return e.map(function(e){return!e});case"INCREMENT_IN":if(void 0!==t.index)return[].concat(f(e.slice(0,t.index)),[e[t.index]+t.value],f(e.slice(t.index+1)));if(void 0!==t.where)return e.map(function(e){return t.where(e)?e+t.value:e});case"DECREMENT_IN":if(void 0!==t.index)return[].concat(f(e.slice(0,t.index)),[e[t.index]-t.value],f(e.slice(t.index+1)));if(void 0!==t.where)return e.map(function(e){return t.where(e)?e-t.value:e});case"INSERT":return[].concat(f(e.slice(0,t.index)),[t.value],f(e.slice(t.index)));case"INCREMENT_ALL":return e.map(function(e){return e+t.value});case"DECREMENT_ALL":return e.map(function(e){return e-t.value});case"MERGE_ALL":return e.map(function(e){return Object.assign(a({},e),t.value)});case"MERGE_IN":if(void 0!==t.index)return[].concat(f(e.slice(0,t.index)),[Object.assign(a({},e[t.index]),t.value)],f(e.slice(t.index+1)));if(void 0!==t.where)return e.map(function(e){return t.where(e)?Object.assign(a({},e),t.value):e});default:return e}}(r,y),t.closedState.state):"object"===(void 0===r?"undefined":i(r))?(t.closedState.state=function(e,t){var r=l(t.type),n=r.verb,u=r.path,y={};if(u){if("SET"===n)return void 0!==t.key?s(p(u,e),e,function(e){return a({},e,c({},t.key,t.value))}):void 0!==t.where?s(p(u,e),e,function(e){return Object.entries(e).forEach(function(e){var r=o(e,2),n=r[0],i=r[1];t.where(n,i)?y[n]=t.value:y[n]=i}),y}):s(p(u,e),e,function(){return t.value});if("INCREMENT_ALL"===n)return s(p(u,e),e,function(e){return e.map(function(e){return e+t.value})});if("INCREMENT_IN"===n){if(void 0!==t.index)return s(p(u,e),e,function(e){return[].concat(f(e.slice(0,t.index)),[e[t.index]+t.value],f(e.slice(t.index+1)))});if(void 0!==t.where)return s(p(u,e),e,function(e){return e.map(function(e){return t.where(e)?e+t.value:e})})}if("DECREMENT_ALL"===n)return s(p(u,e),e,function(e){return e.map(function(e){return e-t.value})});if("DECREMENT_IN"===n){if(void 0!==t.index)return s(p(u,e),e,function(e){return[].concat(f(e.slice(0,t.index)),[e[t.index]-t.value],f(e.slice(t.index+1)))});if(void 0!==t.where)return s(p(u,e),e,function(e){return e.map(function(e){return t.where(e)?e-t.value:e})})}if("INCREMENT"===n)return s(p(u,e),e,function(e){return e+t.value});if("DECREMENT"===n)return s(p(u,e),e,function(e){return e-t.value});if("TOGGLE"===n)return s(p(u,e),e,function(e){return!e});if("TOGGLE_IN"===n){if(void 0!==t.index)return s(p(u,e),e,function(e){return[].concat(f(e.slice(0,t.index)),[!e[t.index]],f(e.slice(t.index+1)))});if(void 0!==t.key)return s(p(u,e),e,function(e){return a({},e,c({},t.key,!e[t.key]))});if(void 0!==t.where)return s(p(u,e),e,function(e){return Array.isArray(e)?e.map(function(e){return t.where(e)?!e:e}):(Object.entries(e).forEach(function(e){var r=o(e,2),n=r[0],i=r[1];t.where(n,i)?y[n]=!i:y[n]=i}),y)})}if("MERGE"===n)return s(p(u,e),e,function(e){return Object.assign(a({},e),t.value)});if("MERGE_IN"===n)return s(p(u,e),e,function(e){if(Array.isArray(e)){if(t.index){var r=[].concat(f(e));return r[t.index]=Object.assign(a({},r[t.index]),t.value),r}if(t.where)return e.map(function(e){return t.where(e)?"object"===(void 0===e?"undefined":i(e))?Object.assign(a({},e),t.value):t.value:e})}if("object"===(void 0===e?"undefined":i(e))){if(void 0!==t.key&&"object"===i(t.value))return a({},e,c({},t.key,Object.assign(a({},e[t.key]),t.value)));if(void 0!==t.key)return a({},e,c({},t.key,t.value));if(void 0!==t.where)return Object.entries(e).forEach(function(e){var r=o(e,2),n=r[0],i=r[1];t.where(n,i)?y[n]=Object.assign(a({},i),t.value):y[n]=a({},i)}),y}});if("MERGE_ALL"===n)return s(p(u,e),e,function(e){return Object.entries(e).forEach(function(e){var r=o(e,2),n=r[0],i=r[1];Array.isArray(i)?y[n]=[].concat(f(i)):y[n]=Object.assign(a({},i),t.value)}),y});if("ADD_TO"===n)return s(p(u,e),e,function(e){return[].concat(f(e),[t.value])});if("INSERT_IN"===n)return s(p(u,e),e,function(e){return[].concat(f(e.slice(0,t.index)),[t.value],f(e.slice(t.index)))});if("REMOVE_ALL"===n)return s(p(u,e),e,function(e){return[]});if("REMOVE_FROM"===n){if(void 0!==t.index)return s(p(u,e),e,function(e){return[].concat(f(e.slice(0,t.index)),f(e.slice(t.index+1)))});if(void 0!==t.where)return s(p(u,e),e,function(e){return e.filter(function(e){return!t.where(e)})})}if("SET_ALL"===n)return s(p(u,e),e,function(e){return e.map(function(e){return t.value})});if("SET_IN"===n){if(void 0!==t.index)return s(p(u,e),e,function(e){return[].concat(f(e.slice(0,t.index)),[t.value],f(e.slice(t.index+1)))});if(void 0!==t.where)return s(p(u,e),e,function(e){return e.map(function(e){return t.where(e)?t.value:e})})}if("TOGGLE_ALL"===n)return s(p(u,e),e,function(e){return e.map(function(e){return!e})})}switch(t.type){case"SET_ALL":return Object.keys(e).forEach(function(e){y[e]=t.value}),y;case"SET_IN":if(void 0!==t.key)return a({},e,c({},t.key,t.value));if(void 0!==t.where)return Object.entries(e).forEach(function(e){var r=o(e,2),n=r[0],i=r[1];t.where(n,i)?y[n]=t.value:y[n]=i}),y;case"MERGE_IN":if(t.value)return Object.entries(e).forEach(function(e){var r=o(e,2),n=r[0],i=r[1];y[n]=a({},i,t.value)}),y;case"MERGE_ALL":return y={},Object.entries(e).forEach(function(e){var r=o(e,2),n=r[0],i=r[1];y[n]=Object.assign(a({},i),t.value)}),y;case"MERGE":return Object.assign(a({},e),t.value);case"REMOVE_ALL":return{};case"REMOVE_IN":if(void 0!==t.key)return delete(y=a({},e))[t.key],y;if(void 0!==t.where)return Object.entries(e).forEach(function(e){var r=o(e,2),n=r[0],i=r[1];t.where(n,i)||(y[n]=i)}),y;case"INCREMENT_IN":return a({},e,c({},t.key,e[t.key]+t.value));case"DECREMENT_IN":return a({},e,c({},t.key,e[t.key]-t.value));case"TOGGLE_ALL":return Object.entries(e).forEach(function(e){var t=o(e,2),r=t[0],n=t[1];y[r]=!n}),y;default:return e}}(r,y),t.closedState.state):void 0}},this.actions=new m(this.closedState)};e.exports={deduce:b.deduce,D:b.actions}}])});
//# sourceMappingURL=dedux.js.map